XCOMM -*- C -*-
XCOMM
XCOMM $Id: Docs.rules,v 1.2 1996-02-16 20:00:15 granger Exp $
XCOMM
XCOMM An Imake rules file for fules which generate postscript and html
XCOMM from FrameMaker books.
XCOMM


/* FM2HTML = /localbin/frame/fm2html */
FM2HTML = fm2html
FRAMELIB = /locallib/frame
TAGSFILE = $(FRAMELIB)/zebra.htags
PRINTFILE = $(FRAMELIB)/mif2gif.printsettings
LANGUAGE = US
FMBATCH = /net/FMaker5/bin/fmbatch
/* FMBATCH = fmbatch */

DOCDIR = /net/shared/zebra/doc/4.2
HTMLDIR = $(DOCDIR)/html/$(BOOK)
POSTSCRIPTDIR = $(DOCDIR)/hardcopy

DISTCLEANFILES = *.backup *.gif *.mif *.html *.html1 *.html2 *.ps *.tmp *.000? *.000??

#ifdef FrameExtension
FMEXT = FrameExtension
#else
FMEXT = book
#endif

BOOKFILE = $(BOOK).$(FMEXT)
BOOKHTML = $(BOOK).html
BOOKPS = $(BOOK).ps

/*
 * By default, don't do anything unless given a specific target
 */

all:: $(BOOKFILE) $(CHAPTERS)

install:: install.ps install.html

/*
 * Install PostScript files into PostScript directory
 */
install.ps:: $(BOOKPS) FORCE
	@echo Installing PostScript files into $(POSTSCRIPTDIR)
	MakeDir($(POSTSCRIPTDIR))
	$(CP) $(BOOKPS) $(POSTSCRIPTDIR)

/*
 * Install hypertext files into html directory
 */
install.html:: $(BOOKHTML) html FORCE
	@echo Installing HTML files into $(HTMLDIR)
	MakeDir($(HTMLDIR))
	$(CP) *.html `ls *.fig_*.ps *.tbl_*.ps *.gif 2>/dev/null` $(HTMLDIR)

html:: $(BOOKHTML)

/*
 * Make the HTML files for this book
 */
$(BOOKHTML):: $(BOOKFILE) $(CHAPTERS)
	MIF2HTMLTAGSFILE=$(TAGSFILE) DOCUMENTLANGUAGE=$(LANGUAGE) \
		$(FM2HTML) -c -s -a $(AUTHOR) $(BOOKFILE)

ps:: $(BOOKPS)

/*
 * Generate PostScript from a FrameMaker book
 */
$(BOOKPS):: $(BOOKFILE) $(CHAPTERS)
	RemoveFile($@)
	@echo Creating $@	;\
	 (echo "Open $(BOOKFILE)"; \
	  echo "Update $(BOOKFILE)"; \
	  echo "Save $(BOOKFILE)" ;\
	  echo "Print $(BOOKFILE)" ;\
	  echo "Quit") >> batch.$$$$ ;\
	$(FMBATCH) < batch.$$$$ ;\
	$(RM) batch.$$$$ ;\
	i=0; while [ \! -f $@ ]; do \
	  i=`expr $$i + 1`; if [ $$i -gt 6 ]; then exit 1; fi; \
	  echo "($$i) waiting for $@ to finish printing..."; \
	  sleep 10; \
	done ;\
	echo "Done."

distclean::
	$(RM) $(DISTCLEANFILES)

FORCE::

.PHONY: install.html install.ps html ps

#ifdef notdef
clean::
	$(RM) $(CLEANFILES)
#endif
