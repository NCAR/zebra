/* -*- C -*-
 * Imakefile for the zebra library.
 */
/*		Copyright (C) 1987,88,89,90,91,92 by UCAR
 *	University Corporation for Atmospheric Research
 *		   All rights reserved
 *
 * No part of this work covered by the copyrights herein may be reproduced
 * or used in any form or by any means -- graphic, electronic, or mechanical,
 * including photocopying, recording, taping, or information storage and
 * retrieval systems -- without permission of the copyright owner.
 * 
 * This software and any accompanying written materials are provided "as is"
 * without warranty of any kind.  UCAR expressly disclaims all warranties of
 * any kind, either express or implied, including but not limited to the
 * implied warranties of merchantibility and fitness for a particular purpose.
 * UCAR does not indemnify any infringement of copyright, patent, or trademark
 * through use or modification of this software.  UCAR does not provide 
 * maintenance or updates for its software.
 */
/* $Id: Imakefile,v 1.26 1997-07-25 21:38:21 granger Exp $ */

#if !HasWritev
WRITEVOBJ=writev.o
WRITEVSRC=writev.c
#else
WRITEVOBJ=
WRITEVSRC=
#endif

#ifdef notdef
INCLUDES = -I.		/* so that <> includes can be found */
#endif

/*
 * Graphics widget needs to know whether to try shared memory, and the
 * ConfigVars routines need to the various default directory paths.
 */
DEPEND_DEFINES = $(SHMDEFINES) $(DIRDEFINES) $(XINCLUDES) $(RDSSINCLUDES)

TESTSRCS = cvt_test.c re_test.c msg_test.c

SRCS = alarmwidget.c altunits.c barb.c Bitmaps.c byteorder.c cmd_proto.c \
	cmd_exec.c ConfigVars.c ConfigUI.c convert.c GraphicsW.c ImageXfr.c \
	Buttons.c msg_BCast.c msg_lib.c netread.c Parse.c pdlib.c pdretrv.c \
	pdaux.c RLEncode.c Sound_lib.c TCvt.c TInterp.c timer_lib.c twidget.c \
	vector.c $(WRITEVSRC) FindFile.c zl_regex.c dm_lib.c $(TESTSRCS) \
	location.c version.c zl_symbol.c zl_string.c T_Expect.c T_Profile.c \
	zebra_xdr.c map.c map_xdr.c

XOBJS = Bitmaps.o barb.o vector.o Buttons.o
XUIOBJS = alarmwidget.o twidget.o dm_lib.o 
UIOBJS = pdlib.o pdretrv.o pdaux.o cmd_proto.o
CFGOBJS = ConfigVars.o ConfigUI.o 

SPECIAL_OBJS = $(XOBJS) $(XUIOBJS) $(UIOBJS) $(CFGOBJS)

OBJS = $(SPECIAL_OBJS) altunits.o byteorder.o cmd_exec.o \
	convert.o GraphicsW.o ImageXfr.o \
	msg_BCast.o msg_lib.o netread.o Parse.o \
	RLEncode.o Sound_lib.o TCvt.o TInterp.o timer_lib.o \
	$(WRITEVOBJ) FindFile.o zl_regex.o zebra_xdr.o map_xdr.o map.o \
	location.o version.o zl_symbol.o zl_string.o T_Expect.o T_Profile.o

TESTOBJS = cvt_test.o re_test.o msg_test.o

HEADERS = bitmaps.h copyright.h defs.h GraphicsW.h GraphicsWP.h message.h \
	pd.h timer.h ImageXfr.h zl_regex.h dm.h twidget.h byteorder.h \
	draw.h version.h zl_symbol.h zl_param.h Test.h zebra.h map.h \
	ZTime.h

RPCZEBRA = zebra.h zebra_xdr.c
ZEBRA.x = zebra.x

RPCMAP = map.h map_xdr.c
MAP.x = map.x

RPCTARGETS = $(RPCZEBRA) $(RPCMAP)
SOURCES.x = $(ZEBRA.x) $(MAP.x)

/*
 * Private internal header files
 */
PHEADERS = setup.h

DISTFILES = $(SRCS) writev.c $(HEADERS) Imakefile $(PHEADERS) $(SOURCES.x)

NormalLibraryTarget (Zebra, $(OBJS))

SpecialObjectRule($(XUIOBJS),/**/,$(XINCLUDES) $(RDSSINCLUDES))
SpecialObjectRule($(XOBJS),/**/,$(XINCLUDES))
SpecialObjectRule($(UIOBJS),/**/,$(RDSSINCLUDES))
SpecialObjectRule($(CFGOBJS),/**/,$(DIRDEFINES) $(RDSSINCLUDES))
SpecialObjectRule(GraphicsW.o,/**/,$(SHMDEFINES) $(XINCLUDES) $(RDSSINCLUDES))

/*
 * rpcgen rules
 */
XDRTarget(zebra)
XDRTarget(map)

InstallLibrary (Zebra, $(LIBDIR))

install::
	(cd $(LIBDIR); $(RM) libZeb.a; $(LN) libZebra.a libZeb.a)

BuildIncludesTop ($(HEADERS))
InstallMultipleFlags($(HEADERS),$(INCDIR),$(INSTINCFLAGS))

DependTarget()

LintTarget()

MSGOBJS = msg_lib.o netread.o version.o
CVTOBJS = cvt_test.o convert.o
REOBJS = re_test.o zl_regex.o version.o

TestProgramTarget(cvt_test,$(CVTOBJS) $(MSGOBJS),/**/,/**/,$(LIBMATH))

TestProgramTarget(re_test,$(REOBJS),/**/,/**/,$(LIBREGEXP))

TestProgramTarget(msg_test, msg_test.o $(MSGOBJS),/**/,/**/,/**/)

RunTestProgram(cvt_test,coordinate conversion,./cvt_test)
RunTestProgram(msg_test,error logging,./msg_test > /dev/null 2>&1)
RunTestProgram(re_test,regular expressions,./re_test)

DistfilesTarget($(DISTFILES))
