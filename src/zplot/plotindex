#! /usr/bin/env perl
#
# $Id: plotindex,v 1.3 2004-03-09 09:12:20 granger Exp $
#
# Create an index.html file from a directory of plot images, so that
# we can control the format and ensure the full file name appears
# in the browser.
#

if ($#ARGV < 1)
{
    print "Usage: $0 <project> <date directory> [<date>]\n";
    print "If no <date>, creates index.html in each of the date directories\n";
    print "in <date directory>.  Otherwise creates only <date>/index.html\n";
    exit 1;
}

$project = $ARGV[0];
$datedir = $ARGV[1];
$select = $ARGV[2];

# Traverse the dates in the directory, creating an index.html for each
# We actually create the index.html for the directory in the previous
# loop iteration, once we know what the "next" directory should be.
$prev = "";
$date = "";
$next = "";
foreach $f (split(/\s+/,`/bin/ls $datedir`), "")
{
    next if ($f && (($f !~ /^\d+/) || ! -d "$datedir/$f"));
    $next = $f;
    if (! $date)
    {
	$date = $f;
	next;
    }
    if (! $select || ($date eq $select))
    {
	&create_index;
    }
    $prev = $date;
    $date = $f;
}


sub create_index
{

    $directory = "$datedir/$date";
    print "Indexing $directory...\n";
    chdir("$datedir/$date");
    $title="Project $project plot images for $date";
    open (HTML, "| sumplot \"$title\" '.*' . . index.html") || 
	die "sumplot: $!";

print HTML "<a href=..>Parent directory</a><HR>\n";
if ($prev)
{
    print HTML "<p>Previous day: <a href=\"../$prev/\">$prev</a></p>\n";
}
if ($next)
{
    print HTML "<p>Next day: <a href=\"../$next/\">$next</a></p>\n";
}
close HTML;

}

# end sub create_index

