/* -*- C -*-
 * Installs the MCIDAS object files into libmcidas.a
 * for ingest modules like
 * nowrad and satellite.  Note that any program which references these
 * routines must also link with the FORTRAN libraries ($(FLIBS))
 */
XCOMM Nearly all of the source files in this directory are U. of Wisconsin 
XCOMM SSEC copyrighted code and should *not* be distributed outside 
XCOMM of NCAR/UCAR.

MFVERSION = "$Id: Imakefile,v 1.9 1997-12-08 18:03:08 burghart Exp $"

FSRCS = cfz.f clit.f flalo.f ftime.f geolat.f idmyyd.f iftok.f iround.f \
	itime.f lit.f llcart.f m0itime.f movcw.f movwc.f nvxgoes.dlm \
	nvxgvar.dlm nvxps.dlm nvxradr.dlm nvxrect.dlm raerac.f solarp.f \
	timdif.f

SRCS =  daytime.c ic_.c mcidas_nav.c movb_.c stc_.c strtofs.c

HEADERS = hex80.inc mcidas.h mcidas_nav.h servacct.h

ALLSRCS = $(FSRCS) $(SRCS)

NAVOBJS = nvxgoes.o nvxgvar.o nvxps.o nvxradr.o nvxrect.o

OBJS =  cfz.o clit.o daytime.o flalo.o ftime.o geolat.o ic_.o idmyyd.o \
	iftok.o iround.o itime.o lit.o llcart.o m0itime.o mcidas_nav.o \
	movb_.o movcw.o movwc.o raerac.o solarp.o stc_.o strtofs.o \
	timdif.o $(NAVOBJS)

/*
 * Leave UNDERSCORE undefined if for some reason a FORTRAN compiler does not
 * want to append underscores to its symbols.  For the architectures we
 * support at present, UNDERSCORE needs to be defined.
 */
DEFINES = -DUNDERSCORE=1


DISTFILES = Imakefile $(ALLSRCS) $(HEADERS) README

all:: $(OBJS)

XCOMM Special targets to rename the common navigation entry points to
XCOMM unique symbols so we can link to all of them in one program:

/*
 * We can't use a -D option to redefine symbols on some FORTRAN compilers
 * (i.e., AIX), so we have to do the substitutions ourselves.
 */
#define NavRule(base,sub) \
base.o: base.dlm							@@\
	$(RM) base.f							@@\
	sed `echo ' ' -e 's/NVXINI/NNNINI/g' -e 's/NVXEAS/NNNEAS/g' \	@@\
	          -e 's/NVXSAE/NNNSAE/g' -e 's/NVXOPT/NNNOPT/g' | \	@@\
		sed -e 's,NNN,sub,g'` < base.dlm > base.f		@@\
	RemoveFile($@)							@@\
	$(FC) -c $(FCFLAGS) base.f					@@\
									@@\
clean::									@@\
	RemoveFile(base.f)						@@\



/*
 * These name substitutions must match the method names used in mcidas.c!
 * And they must begin with I-N so FORTRAN returns an integer type!
 */
NavRule(nvxgoes,NGS)
NavRule(nvxgvar,NGV)
NavRule(nvxps,NPS)
NavRule(nvxradr,NRA)
NavRule(nvxrect,NRC)

NormalLibraryTarget(mcidas,$(OBJS))

InstallLibrary(mcidas,$(LIBDIR))

BuildIncludesTop($(HEADERS))
InstallMultipleFlags(mcidas_nav.h,$(INCDIR),$(INSTINCFLAGS))

DistfilesTarget($(DISTFILES))

DependTarget()

