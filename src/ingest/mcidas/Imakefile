/* -*- C -*-
 * Installs the MCIDAS object files into libmcidas.a
 * for ingest modules like
 * nowrad and satellite.  Note that any program which references these
 * routines must also link with the FORTRAN libraries ($(FLIBS))
 */
XCOMM Nearly all of the source files in this directory are U. of Wisconsin 
XCOMM SSEC copyrighted code and should *not* be distributed outside 
XCOMM of NCAR/UCAR.

MFVERSION = "$Id: Imakefile,v 1.10 1998-08-18 14:46:15 burghart Exp $"

FSRCS = asspl2.f blmodel.f calday.f cfi.f cfz.f clit.f cotan.f flalo.f \
	ftime.f geolat.f idmyyd.f iftok.f iround.f itime.f julday.f ksys.f \
	lbchek.f lbget.f lit.f llcart.f m0itime.f mcgput.f movcw.f movwc.f \
	nthday.f raerac.f solarp.f timdif.f vecrot.f verneq.f

SRCS =  argcmd.c argparse.c argutil.c blelems.c cnav.c date.c daytime.c \
	di.c eaccess.c envvec.c fbyte4_.c fpaddr_.c frame.c fs.c fsalloc.c \
	fslen.c gpnav.c handle.c ic_.c ingrpset.c ischar_.c locus.c luc_.c \
	m0buf.c m0cache.c m0isbase.c m0mcpath.c m0mctext.c m0redir.c \
	m0spout.c mat2.c mcidas_nav.c mcluc.c mclucase.c mcprintf.c mcread.c \
	movb_.c movw_.c nchdl.c pathcat.c pathname.c pathtok.c pathvec.c \
	planet.c puc_.c pvsearch.c sh_match.c spout_.c stc_.c stralloc.c \
	stricmp.c strrepl.c strtofs.c swbyt4_.c vec.c vector.c

HEADERS = hex80.inc m0arg.h m0file.h m0frame.h m0glue.h m0gpnav.h mcidas.h \
	  mcidas_nav.h mcidasp.h servacct.h

ALLSRCS = $(FSRCS) $(SRCS)

NAVOBJS = nvxdmsp.o nvxgoes.o nvxgraf.o nvxgvar.o nvxlamb.o nvxmerc.o \
	  nvxmoll.o nvxmsat.o nvxps.o nvxradr.o nvxrect.o nvxsin.o \
	  nvxtanc.o nvxtiro.o

OBJS =  argcmd.o argparse.o argutil.o asspl2.o blelems.o blmodel.o calday.o \
	cfi.o cfz.o clit.o cnav.o cotan.o date.o daytime.o di.o eaccess.o \
	envvec.o fbyte4_.o flalo.o fpaddr_.o frame.o fs.o fsalloc.o fslen.o \
	ftime.o geolat.o gpnav.o handle.o ic_.o idmyyd.o iftok.o ingrpset.o \
	iround.o ischar_.o itime.o julday.o ksys.o lbchek.o lbget.o lit.o \
	llcart.o locus.o luc_.o m0buf.o m0cache.o m0isbase.o m0itime.o \
	m0mcpath.o m0mctext.o m0redir.o m0spout.o mat2.o mcgput.o \
	mcidas_nav.o mcluc.o mclucase.o mcprintf.o mcread.o movb_.o movcw.o \
	movw_.o movwc.o nchdl.o nthday.o pathcat.o pathname.o pathtok.o \
	pathvec.o planet.o puc_.o pvsearch.o raerac.o sh_match.o solarp.o \
	spout_.o stc_.o stralloc.o stricmp.o strrepl.o strtofs.o swbyt4_.o \
	timdif.o vec.o vecrot.o vector.o verneq.o $(NAVOBJS)

/*
 * Leave UNDERSCORE undefined if for some reason a FORTRAN compiler does not
 * want to append underscores to its symbols.  For the architectures we
 * support at present, UNDERSCORE needs to be defined.
 */
DEFINES = -DUNDERSCORE=1


DISTFILES = Imakefile $(ALLSRCS) $(HEADERS) README

all:: $(OBJS)

XCOMM Special targets to rename the common navigation entry points to
XCOMM unique symbols so we can link to all of them in one program:

/*
 * We can't use a -D option to redefine symbols on some FORTRAN compilers
 * (i.e., AIX), so we have to do the substitutions ourselves.
 */
#define NavRule(base,sub) \
base.o: base.dlm							@@\
	$(RM) base.f							@@\
	sed `echo ' ' -e 's/NVXINI/NNNINI/g' -e 's/NVXEAS/NNNEAS/g' \	@@\
	          -e 's/NVXSAE/NNNSAE/g' -e 's/NVXOPT/NNNOPT/g' | \	@@\
		sed -e 's,NNN,sub,g'` < base.dlm > base.f		@@\
	RemoveFile($@)							@@\
	$(FC) -c $(FCFLAGS) base.f					@@\
									@@\
clean::									@@\
	RemoveFile(base.f)						@@\



/*
 * These name substitutions must match the method names used in mcidas.c!
 * And they must begin with I-N so FORTRAN returns an integer type!
 */
NavRule(nvxdmsp,NDM)
NavRule(nvxgoes,NGS)
NavRule(nvxgraf,NGR)
NavRule(nvxgvar,NGV)
NavRule(nvxlamb,NLA)
NavRule(nvxmerc,NME)
NavRule(nvxmoll,NMO)
NavRule(nvxmsat,NMS)
NavRule(nvxps,NPS)
NavRule(nvxradr,NRA)
NavRule(nvxrect,NRC)
NavRule(nvxsin,NSI)
NavRule(nvxtanc,NTA)
NavRule(nvxtiro,NTI)

NormalLibraryTarget(mcidas,$(OBJS))

InstallLibrary(mcidas,$(LIBDIR))

BuildIncludesTop($(HEADERS))
InstallMultipleFlags(mcidas_nav.h,$(INCDIR),$(INSTINCFLAGS))

DistfilesTarget($(DISTFILES))

DependTarget()

