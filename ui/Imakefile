/* -*- C -*- */
MFVERSION="$Id: Imakefile,v 1.4 1995-05-24 22:49:19 granger Exp $"
/*		Copyright (C) 1987,88,89,90,91 by UCAR
 *	University Corporation for Atmospheric Research
 *		   All rights reserved
 *
 * No part of this work covered by the copyrights herein may be reproduced
 * or used in any form or by any means -- graphic, electronic, or mechanical,
 * including photocopying, recording, taping, or information storage and
 * retrieval systems -- without permission of the copyright owner.
 * 
 * This software and any accompanying written materials are provided "as is"
 * without warranty of any kind.  UCAR expressly disclaims all warranties of
 * any kind, either express or implied, including but not limited to the
 * implied warranties of merchantibility and fitness for a particular purpose.
 * UCAR does not indemnify any infringement of copyright, patent, or trademark
 * through use or modification of this software.  UCAR does not provide 
 * maintenance or updates for its software.
 */

LOCALLIB = uilib.a
UI_LF = $(LIBDIR)/ui.lf

#if UseXWindows
INCLUDES = $(XINCLUDES)
LIBS = $(LIBRDSSUTIL) $(XLIBS)
#else
INCLUDES =
LIBS = $(LIBRDSSUTIL)
#endif

SYSLIBS = $(LIBMATH) $(LIBTERMCAP) $(LIBREGEXP)

DEPLIBS = $(LIBRDSSUTIL)

UIDIR = -DUIDIR=\"$(RDSSDIR)\"
LFDIR = -DLF=\"$(UI_LF)\"
MENUDEFINES = -DSMEMENU
NORMAL_DEFINES = $(UIDIR) $(LFDIR) $(XWINDOWSFLAG) $(MENUDEFINES)

#if defined(SunArchitecture) && !SystemV4 && !SystemV
SYSDEFINES = -DBSD
#else
#if defined(SVR4Architecture) || SVR4 || SYSV || SystemV4 || SystemV
SYSDEFINES = -DSYSV
#else
SYSDEFINES =
#endif
#endif

EXTRA_DEFINES = $(RDSS_EXTRA_DEFS) $(NORMAL_DEFINES) $(SYSDEFINES)

BINSRCS = uic.c uib.c

/*
 * Override UIB variable to always use the local one
 */
UIB = ./uib

# if (UseXWindows || (UseOpenWindows && !OldOpenWin))
SMEMENUOBJS= SmeMenu.o RdssMenu.o
# else
SMEMENUOBJS=
# endif

SMEMENUSRCS= $(SMEMENUOBJS:.o=.c)

LIBOBJS = ui.o ui_bootstrap.o ui_date.o ui_error.o ui_symbol.o ui_util.o \
	ui_ctable.o ui_state.o ui_expr.o ui_keys.o ui_types.o ui_token.o \
	ui_prompt.o ui_parser.o ui_menu.o ui_interrupt.o ui_tty.o ui_cmds.o \
	ui_cstack.o ui_output.o ui_function.o ui_string.o ui_window.o \
	ui_wPulldown.o ui_wList.o ui_wAppl.o ui_OutHook.o ui_globals.o \
	ui_wForm.o $(SMEMENUOBJS)

LIBSRCS = ui.c ui_bootstrap.c ui_date.c ui_error.c ui_symbol.c ui_util.c \
	ui_ctable.c ui_state.c ui_expr.c ui_keys.c ui_types.c ui_token.c \
	ui_prompt.c ui_parser.c ui_menu.c ui_interrupt.c ui_tty.c ui_cmds.c \
	ui_cstack.c ui_output.c ui_function.c ui_string.c ui_window.c \
	ui_wPulldown.c ui_wList.c ui_wAppl.c ui_OutHook.c ui_globals.c \
	ui_wForm.c $(SMEMENUSRCS)

SRCS = 	$(BINSRCS) $(LIBSRCS)

HEADERS = SmeMenu.h RdssMenu.h ui.h ui_symbol.h ui_param.h ui_error.h \
	ui_date.h ui_expr.h

PRIVATE_HEADERS = submenu.h ui_commands.h ui_cstack.h ui_globals.h \
	ui_loadfile.h ui_menu.h ui_mode.h ui_state.h ui_token.h \
	ui_tty.h ui_window.h RdssMenuP.h SmeMenuP.h X11/Xfuncproto.h

/*
 * Distribute ui_commands. and ui_commands.def as copies of ui_commands,
 * since ordinarily they will simply be links to ui_commands
 */
DISTFILES = Imakefile ui_commands ui_commands. ui_commands.def \
	ui.state $(SRCS) $(HEADERS) $(PRIVATE_HEADERS)

/*
 * When RDSS moves to R6 imake, this ifdef can be removed.
 */
#ifdef ProjectZebra

NormalLibraryTarget(rdssui,$(LIBOBJS))
InstallLibrary(rdssui,$(LIBDIR))

CompleteProgramTarget(uib, uib.o $(LIBOBJS),$(DEPLIBS),$(LIBS),$(SYSLIBS))
CompleteProgramTarget(uic, uic.o $(LIBOBJS),$(DEPLIBS),$(LIBS),$(SYSLIBS))

#else /* ProjectRDSSLibs */

AllTarget ($(LIBOBJS))
NormalLibraryTarget($(LOCALLIB),$(LIBOBJS))

NormalProgramTarget(uib,uib.o $(LIBOBJS),$(DEPLIBS),$(LIBS),$(SYSLIBS))
NormalProgramTarget(uic,uic.o $(LIBOBJS),$(DEPLIBS),$(LIBS),$(SYSLIBS))

InstallObjectsIntoLibrary($(LIBRDSSUI),$(LIBOBJS))

#endif /* ProjectZebra */

UIBootFileDepsTarget(ui.lf, ui.state, ui_commands. $(UIB))

BuildIncludes($(HEADERS),.,.)

DependTarget()

s_uic:
	#setopt ansi
	#load $(CFLAGS) uic.c ui.c ui_w*.c ui.a -Bstatic $(LIBS)

LintTarget()

DistfilesTarget($(DISTFILES))

